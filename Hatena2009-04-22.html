<!DOCTYPE html>
<html lang="en"><head><title>Hatena2009-04-22</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ü™¥ Quartz 4.0"/><meta property="og:title" content="Hatena2009-04-22"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2009-04-22"/><meta name="twitter:description" content="hatena &lt;body> *1240349665*[erlang]Studying 2 >|erlang| 77> F = fun(X, Y) -> X + Y end. #Fun&lt;erl_eval.12.113037538> 78> F(1, 2)."/><meta property="og:description" content="hatena &lt;body> *1240349665*[erlang]Studying 2 >|erlang| 77> F = fun(X, Y) -> X + Y end. #Fun&lt;erl_eval.12.113037538> 78> F(1, 2)."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1240349665*[erlang]Studying 2 >|erlang| 77> F = fun(X, Y) -> X + Y end. #Fun&lt;erl_eval.12.113037538> 78> F(1, 2)."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2009-04-22"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2009-04-22"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1240349665*[erlang]Studying 2 >|erlang| 77> F = fun(X, Y) -> X + Y end. #Fun&lt;erl_eval.12.113037538> 78> F(1, 2)."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2009-04-22"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">ü™¥ Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href>Hatena2009-04-22</a></div></nav><h1 class="article-title">Hatena2009-04-22</h1><p show-comma="true" class="content-meta"><span>Apr 22, 2009</span><span>5 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1240349665*[erlang]Studying 2
>|erlang|
77> F = fun(X, Y) -> X + Y end.
#Fun&lt;erl_eval.12.113037538>
78> F(1, 2).
3
||&lt;

Functions are first-class objects.

>|erlang|
79> X = io.
io
80> X:format(&quot;hoge~n&quot;).
hoge
ok
||&lt;

The module also looks like a first class object. In fact, they are atoms.

>|erlang|
81> Y = X:format.
* 1: illegal expression
||&lt;

Huh. I wonder if I can do this.

http://erlang.org/doc/man/erlang.html#apply-2

>|erlang|
82> Y = format.
format
83> apply(X, Y, [&quot;hoge~n&quot;]).
hoge
ok
||&lt;

It's a bit sloppy, but it can be done in a way.

*1240389207*[erlang] I made a counter for now.
In the meantime, I'm going to try to make a counter once I learn some Perl: &lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20080220/1203524977'>OOP - NISHIO Hirokazu's Hatena Diary&lt;/a>. or a JS version. I think there was an AS version, but I couldn't find it.

Now, when it comes to creating counters in Erlang, the single assignment seems to be a stumbling block.

>|erlang|
15> CounterValue = 0.
0
16> CounterValue = CounterValue + 1.
** exception error: no match of right hand side value 1
||&lt;

It is true that it is &quot;surprising&quot; to most people that Erlang's ordinary variables behave in this way, so it is understandable that they would draw attention to this feature when writing articles and the like. But since there is a process dictionary, single assignment is not something that needs to be mentioned.

>|erlang|
17> put(counter_value, 0).
undefined
18> get().                
[{counter_value,0}]
19> put(counter_value, get(counter_value) + 1).
0
20> get().                                     
[{counter_value,1}]
||&lt;

Even in the processes that everyone uses &quot;assignment&quot; for some reason or another, if you take a closer look, you will find that there are some that require rewriting the value called by that name and others that are just temporarily called by that name and do not need to be rewritten. In Erlang, all variables are const from the beginning, and only those that are not const are written in a different notation.

So, as the name &quot;process dictionary&quot; suggests, this dictionary is in units of processes, so if you think in terms of &quot;one program, one process&quot;, this corresponds to the global scope. But Erlang is a very cheap language for processes, so if you don't want to pollute the global scope, just create a new process and make it a &quot;new scope&quot;. Since counters are expected to &quot;run multiple counters at the same time without interference&quot;, multiple &quot;counter objects&quot; become multiple processes in Erlang.

Now, it is time to end the background explanation and move on to the implementation. I used gen_fsm for implementation. This time, there is only one type of state, counting, so there was not much reason to use gen_fsm, but I did not think it would be too short even if I did not use it. I thought it would be easier to make it on the framework of gen_fsm, considering that this code can be reused when I need to create multiple instances in the future. In a word, it is a hassle to do &quot;receive&quot; by myself. It's also messy to modify the process dictionary by myself.

Behaviour is the &quot;Template Method&quot; pattern in Java, where you &quot;inherit&quot; from the gen_fsm &quot;class&quot; and implement &quot;methods&quot; such as init/1 and terminate/3, and gen_fsm will call them to perform a series of tasks. The words in parentheses are Java words.

>|erlang|
-module(counter).
-behaviour(gen_fsm).

-export([start_link/1]).
-export([push/1, reset/1, counting/2]).
-export([init/1, terminate/3]).

start_link(Name) ->
    gen_fsm:start_link({local, Name}, counter, 0, []).

push(Name) ->
    gen_fsm:send_event(Name, {push, 1}).

reset(Name) ->
    gen_fsm:send_event(Name, {reset, 0}).


init(Num) ->
    {ok, counting, Num}.

counting(Event, Data) -> 
    case Event of
    	 {push, Num} -> NewData = Data + Num;
    	 {reset, Num} -> NewData = Num
    end,
    io:format(&quot;vaulue=~p~n&quot;, [NewData]),
    {next_state, counting, NewData}.


terminate(_WhatsThis, _StateName, _StateData) ->
    ok.
||&lt;

Use it like this. You can see that multiple instances are working properly without interference.

>|erlang|
8> counter:start_link(c1).
{ok,&lt;0.53.0>}
9> counter:push(c1).      
vaulue=1
ok
10> counter:push(c1).
vaulue=2
ok
11> counter:start_link(c2).
{ok,&lt;0.57.0>}
12> counter:push(c2).      
vaulue=1
ok
13> counter:push(c1).      
vaulue=3
ok
14> counter:push(c2).
vaulue=2
ok
||&lt;

If multiple processes are launched (&lt;0.53.0> or &lt;0.57.0>), it is not possible to press a button on the counter process without remembering the Pid of each individual process. However, since raw Pids and raw pointer values are difficult to handle, we want to name them, so we pass a name as an argument and let the process register with that name.

Since the counter Pid is &quot;a value that does not need to change,&quot; it may be better behaved to design it to be written as shown below. But it is troublesome.

>||
{_Status, Counter1} = counter:start_link().
||&lt;

*1240408068*a^2 - b^2 = (a - b) * (a + b)
&lt;img src=&quot;http://gyazo.com/fc15dfacd7417e99d3606d3d78e921c2.png&quot;>

*1240423136* that
I drew this for commentary.

&lt;img src=&quot;http://gyazo.com/c134e270e97ad44cebcfcac3c5ff5ee2.png&quot;>

*1240425286* How many vertices does a four-dimensional hypercube have?
Figure drawn to explain the problem of

&lt;img src=&quot;http://gyazo.com/ec1d5b9b1afb01482fe1b21d3abcec54.png&quot;>

*1240428559* Something like a quadratic function solution.
&lt;img src=&quot;http://gyazo.com/234fb5bc55e5b5e92aba46b58bcf8cdc.png&quot;>
&lt;/body>
</code></pre>
<h2 id="hatena-diary-2009-04-22"><a href="https://nishiohirokazu.hatenadiary.org/archive/2009/04/22" class="external">Hatena Diary 2009-04-22<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2009-04-22" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2009-04-22" class="external">/nishio/Hatena2009-04-22<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I‚Äôm very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> ¬© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>