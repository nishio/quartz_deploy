<!DOCTYPE html>
<html lang="en"><head><title>Geister Algorithm Explained</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="Geister Algorithm Explained"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Geister Algorithm Explained"/><meta name="twitter:description" content="..."/><meta property="og:description" content="..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Geister-Algorithm-Explained"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Geister-Algorithm-Explained"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Geister-Algorithm-Explained"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Geister Algorithm Explained</a></div></nav><h1 class="article-title">Geister Algorithm Explained</h1><p show-comma="true" class="content-meta"><span>Dec 20, 2017</span><span>10 min read</span></p></div></div><article class="popover-hint"><ul>
<li>Geister AI using Partial Observation Monte Carlo Programming
<ul>
<li>Cybozu Labs NISHIO Hirokazu</li>
</ul>
</li>
<li>Purpose of this paper
<ul>
<li>A brief description of what’s in the AI that was submitted to and won second place in the Guyster AI competition at GPW in November 2017 will facilitate research on how to build AI in situations where inference of unobservable information is important.</li>
<li><a href="http://www2.matsue-ct.ac.jp/home/hashimoto/geister/" class="external">http://www2.matsue-ct.ac.jp/home/hashimoto/geister/<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a></li>
</ul>
</li>
<li>Pitfalls of thinking in discrete logic
<ul>
<li>For example, let’s say there is a rock-paper-scissors game in which players get one point if they buy with goo, and two points if they buy with choki and par. How can we create a strong AI for this game?</li>
<li>As a first step, let’s say that your opponent has a 1/3 chance of choosing your move. In such a case, the expected point difference is the highest if you choose to play choki. If you win, you get 2 points, and if your opponent wins, he gets 1 point.</li>
<li>Then, is the best strategy “a strategy to play choki”? As you can see, that strategy loses out to the “goo strategy. That strategy loses to the “par strategy. And that strategy loses to the strategy of making a “Choki”. You think you are thinking logically, but your thoughts go in circles, and you give up creating AI.</li>
<li>In this game, there are three possible action options: goo, choki, and par. If we consider the strategy of this game as “a function that takes a situation as an argument and returns one of the three actions,” we will be stuck in the roundabout way described above. Instead, we need to extend it to “a function that takes a situation as an argument and returns a three-dimensional vector of real values. The return value of this function is assumed to be the sum of 1. It is a discrete probability distribution. Within this framework, the return value for “a strategy that produces goo” is (1, 0, 0), and the return value for “a strategy that chooses each option with a probability of 1/3” is (1/3, 1/3, 1/3).</li>
<li>The framework, in which action alternatives are chosen stochastically, is a “mixed strategy game” in the language of game theory. Nash’s theorem proves that there exists at least one Nash equilibrium in a mixed strategy game. A Nash equilibrium is “a combination of strategies in which no player can obtain a higher gain by changing his or her strategy. If the Geister AI becomes strong enough, it will reach this Nash equilibrium.</li>
</ul>
</li>
<li>partially observed Markov decision process
<ul>
<li>If, in a certain board state s, I take action a, how can I describe the board state s’ when it is my turn next?</li>
<li>In the field of reinforcement learning, this is considered a Markov decision process. In other words, the transition from one state s to another state s’ is probabilistic according to the transition probability P(s, a, s’).</li>
<li>This “board state” is not the board as seen by you. It includes hidden information that only the opponent can see. This is because the probability that the opponent chooses each action is affected by information that only the opponent can see. In other words, Geister is a Markov decision process, but one player cannot observe all of the states. This is called a partially observed Markov decision process. This is a problem setting that is often studied in the field of reinforcement learning.</li>
<li>The information that cannot be observed by one player is “which of the 70 possible initial placements of the opponent’s pieces was 8C4”. If we express which we think it was by a real number between 0 and 1, it becomes a 70-dimensional vector of real numbers. This is called the “belief” in the other’s initial placement. This vector has a sum of 1 and can be thought of as a discrete probability distribution.</li>
<li>Many people mistakenly believe that the “state” of a Markov decision process is a discrete set. If you imagine a robot’s attitude control, you will see that the state can be continuous in general. Therefore, let us include a 70-dimensional real-valued belief vector as a state. In a partially observed Markov decision process, by including beliefs about unobservable information in the state as a probability distribution, we can create a new fully observed Markov decision process. This is called belief MDP.</li>
<li>The partial problem of “estimating the opponent’s color” in Geister can be thought of as a Bayesian estimation process in which the prior distribution of beliefs is updated by observing the opponent’s behavioral information. As a concrete example, consider the case where you observe that “the opponent’s piece is just before the goal, but in the opponent’s turn, the opponent did not score a goal. Think about what you would do if you were in your opponent’s position. Since you did not know in advance whether the piece was red or blue, assume a 50% chance of both. If the piece is blue, I would have a 25% chance of not scoring a goal, which you may think is 0%, but this is for the sake of explanation. If the piece is red, you cannot finish the goal, so you will not finish 100% of the time. The observed fact was “no goal”. So, the observed fact is reproduced with a probability of 50%×25% + 50%×100%. The 50% x 25% case is blue. In other words, the belief in this frame is updated from 50% blue and 50% red to 20% blue and 80% red by this observation.</li>
<li>Since the observation of the goal line is extreme in probability, a person thinking in terms of logic could have similarly deduced that “this frame is red”. In reality, ambiguous observations are observed, such as “When I pressed him to exchange the frames, he ran away,” which cannot be confirmed to be blue, but cannot be said to be uninformed either. The game of Geister is to gradually seize the opponent’s secret information from these observations and build up an advantageous position.</li>
</ul>
</li>
<li>Partial Observation Monte Carlo Programming
<ul>
<li>Geister is not only a partially observed Markov decision process, but also a tricky problem where the state transition probabilities are not explicitly given. Partially observed Monte Carlo programming can be used in such situations. Instead of state transition probabilities, a black box simulator that can be run repeatedly is given to solve the problem in Monte Carlo.</li>
<li>Partial Observation Monte Carlo programming is a combination of particle filtering (also known as Sequential Monte Carlo) and Monte Carlo tree search. The particle filter updates the belief distribution. Specifically, the state is sampled from the belief distribution, and the simulator assumes that the state is the same as the belief distribution and allows the opponent’s move to advance by one move. The remaining samples are discarded, leaving only those that match the opponent’s actual move, resulting in a new belief distribution that has been updated by the observation of the opponent’s move.</li>
<li>The Monte Carlo tree search part assumes a state sampled from the belief distribution and selects moves according to an appropriate rollout policy from that state to obtain information on which moves have a high winning rate. This information is accumulated in a tree structure, and when a certain amount of information has been gathered, moves are selected using another Tree Policy (the famous UCB1).</li>
<li>The author implemented this Partial Observation Monte Carlo Programming method in this contest. Particle Reinvigoration, described below, was not implemented due to lack of time. In addition, a model of the opponent AI is necessary in the implementation of the simulator. There are two versions of this model: the version with the algorithm Fastest (POMCP-Fastest), which “aims to reach the goal in blue anyway,” and the version with the algorithm Ichi (POMCP-Ichi), which does not anticipate any move, and whose value function is constructed by craftsmanship by combining if statements based on Nishio’s sensibilities ( POMCP-Ichi).</li>
</ul>
</li>
<li>Results and Discussion
<ul>
<li>Unfortunately, the author did not understand that the tournament was to be held as part of a workshop requiring advance registration, and by the time he realized it, registration had closed, so he sent only the program to play against us. A round-robin competition of all AIs was held, and the author’s POMCP-Ichi and Naoto Kawakami’s Naocchi MINMAX won all the games against the other participants and tied each other with one win and one loss against each other. The two AIs played two rounds of playoffs to determine the winner, with POMCP-Ichi winning the second place with two defeats.</li>
<li>I guess from the name that Naochi MINMAX uses the MinMax method, which is a “worst-case best-case move” method, and is very risk-averse and cautious in nature. On the other hand, the author’s POMCP does not implement Particle Reinvigoration by cutting corners. Let’s consider. The particle filter updates beliefs by sampling from the belief state and rejecting a portion of it. Even if there is no difference in the rejected part, the strength of beliefs will randomly walk due to luck of sampling. And if by bad luck the particle goes to zero, the belief is never sampled again. It is the strong nature of the belief that if one believes, “It must not be X,” one will never again consider the possibility that it is X. Particle Reinvigoration mitigates this.</li>
<li>In fact, this was a known problem. In a user test conducted only once due to time constraints, POMCP-Fastest pushed his opponent, Ikuo Takeuchi, to a bet of two choices, one blue and one red, but as the two players glanced at each other before the goal, he thought, “This panel that is not advancing must be red,” and left the goal, losing easily. The red one was easily defeated. This was also the reason why I had to prepare Ichi, which was more decent than Fastest, in a hurry.</li>
</ul>
</li>
<li>summary
<ul>
<li>He explained “beliefs,” a useful concept for Geister’s AI, and partial observation Monte Carlo programming, a useful algorithm for estimating them. We hope this information will make future Geister AI competitions more interesting.</li>
<li>The author is thinking of competing next time with POMCP-MinMax after implementing Particle Reinvigoration. He also predicts that a beneficial AI will occupy a very small subspace of the total space of possible AIs, and he thinks it would be possible to estimate the algorithm of the opponent, just as it would be possible to estimate the initial placement of the red frames. The author is convinced from his own experience against human opponents that side-channel attacks, which steal information from thinking time, are effective when the opponent is human. Also, the current POMCP does not contain any optimization to reduce information leakage from one’s actions. Since the publication of this article has increased the probability of POMCP coming to the opponent, there is a way to create POMCP-POMCP to counter it. And POMCP-(POMCP-POMCP). If we repeat this infinitely, we will probably reach Nash equilibrium.</li>
</ul>
</li>
</ul>
<hr/>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/%E3%82%AC%E3%82%A4%E3%82%B9%E3%82%BF%E3%83%BC%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0%E8%A7%A3%E8%AA%AC" class="external">/nishio/ガイスターアルゴリズム解説<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I’m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>