<!DOCTYPE html>
<html lang="en"><head><title>Hatena2009-02-13</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="Hatena2009-02-13"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2009-02-13"/><meta name="twitter:description" content="hatena &lt;body> *1234474483*Housekeeping I woke up. What we do today - Wake up in the morning - Wash dishes - □ Wash PET bottles - □ Collecting mail that had accumulated in the mailbox -- □ Throw away what you don't need - □ Write a reply to your email - □ My credit card was not accepted and maybe the amount of deposit in the bank is short."/><meta property="og:description" content="hatena &lt;body> *1234474483*Housekeeping I woke up. What we do today - Wake up in the morning - Wash dishes - □ Wash PET bottles - □ Collecting mail that had accumulated in the mailbox -- □ Throw away what you don't need - □ Write a reply to your email - □ My credit card was not accepted and maybe the amount of deposit in the bank is short."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1234474483*Housekeeping I woke up. What we do today - Wake up in the morning - Wash dishes - □ Wash PET bottles - □ Collecting mail that had accumulated in the mailbox -- □ Throw away what you don't need - □ Write a reply to your email - □ My credit card was not accepted and maybe the amount of deposit in the bank is short."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2009-02-13"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2009-02-13"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1234474483*Housekeeping I woke up. What we do today - Wake up in the morning - Wash dishes - □ Wash PET bottles - □ Collecting mail that had accumulated in the mailbox -- □ Throw away what you don't need - □ Write a reply to your email - □ My credit card was not accepted and maybe the amount of deposit in the bank is short."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2009-02-13"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Hatena2009-02-13</a></div></nav><h1 class="article-title">Hatena2009-02-13</h1><p show-comma="true" class="content-meta"><span>Feb 13, 2009</span><span>6 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1234474483*Housekeeping
I woke up.


What we do today
- Wake up in the morning
- Wash dishes
- □ Wash PET bottles
- □ Collecting mail that had accumulated in the mailbox
-- □ Throw away what you don't need
- □ Write a reply to your email
- □ My credit card was not accepted and maybe the amount of deposit in the bank is short. I go to bookkeeping. But usually you get a phone call or an e-mail or something.
-- ■ I tried to view my Rakuten KC statement on the web, but the system had changed, so I am registering as a member. □ I change my address after moving.
- □ Clean up the room
- Map
- Headphones
- □ Summarize how to create a GAE project
- □ About Mercurial's bisect

the others
- 15 Receive keys to new house
- 18 Resource Trash Day. Throw away as much unwanted newspapers, magazines, etc. as possible.
- 20 pots / debit your Rakuten card
- 28 Return of keys to current address
- I'll get a haircut soon (maybe next time I'm in Akihabara).

*1234475993*[Python] type declaration and assert in constructor
When you are designing with a Java-like mind, you may want to write something like this. Hit points are integers. In reality, Python is not written in this way.

>|python|
class Monster(object):
    hitpoint = int
    defense = int
    attack = int

||&lt;

So, since I had developed the design in this way of writing without writing the code out of the blue, I thought, since I'm here, how about putting it to good use? Use it for assertions at the end of the constructor.

>|python|
class Monster(object):
    field_types = dict(
        hitpoint=int,
        defense=int,
        attack=int,
    )
    def __init__(self, **kw):
        self.__dict__.update(kw)

        for k, v in self.field_types.items():
            assert isinstance(getattr(self, k), v)
||&lt;

If you mistype &quot;Monster(attack=1, defence=1, hitpoint=1)&quot;, it will stop on assert. fail-fast. you can automatically add a metaclass that says &quot;do this at the end of __init__&quot;, but it's a bit much. I think it's a bit too much.

*1234477277*Favorite Quote &quot;You don't need anything that you have to worry about whether you need it or not.&quot;
I'm always having to search for the exact wording, so I'll just write it here.
>>
&quot;Metaclasses are deeper magic than 99% of users should ever worry about. If you wonder whether you need them, you don't (the people who actually need them know with certainty that they need them, and don't need an explanation about why). -- Python Guru Tim Peters&quot;
&lt;&lt;

'If you're wondering if you need it, you don't need it. If you really need it, you are convinced that you 'need it. ' I don't have to explain to you why you need it.&quot;

I'm talking about Python's metaclasses, but I think it's a more universal truth, not just a feature of the language. Let's clean the room while tweeting this.

*1234478455* Missing pills
A pill that I dropped and lost while trying to drink fell out when I scratched my head! Magic!

*1234536216*Rehabilitation
I've been feeling good for a while now, but then I suddenly started to feel bad. I need to go to rehab.

*1234536787*Quick Sort
Rehab Part 2 (ref. &lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20090120/1232461815'>Slump Escape Method&lt;/a>, &lt;a href='http://d.hatena.ne.jp/ nishiohirokazu/20090120/1232476435'>Fibonacci Sequence&lt;/a>)

&lt;img src=&quot;http://gyazo.com/c92b099f37f2009a8dff3278b393c63e.png&quot;>

>|python|
from random import shuffle
data = range(100)
shuffle(data)

# recursion
def qsort(data):
    if not data: return data
    pivot = data[0]
    rest = data[1:]
    greater = [x for x in rest if x > pivot]
    lesser = [x for x in rest if x &lt;= pivot]
    return qsort(lesser) + [pivot] + qsort(greater)

print qsort(data)
||&lt;


Loop version difficult. This one only has one pivot to swing in and out...
>|python|
# loop
def qsort_loop(data):
    &quot;&quot;&quot;
    ... pivot a b c ... last done ... When
    if a &lt; pivot:
        ... a pivot b c ...
    else:
        ... pivor b c ... last a done ...
        is naive, but there are many copies of this one.
        ... pivor last b c ... a done ...

    &quot;&quot;&quot;
    if not data: return data
    pivot = data[0]
    cur = 1
    done = len(data)
    while cur != done:
        v = data[cur]
        if v &lt; pivot:
            data[cur - 1] = v
            data[cur] = pivot
            cur += 1
        else:
            data[cur] = data[done - 1]
            data[done - 1] = v
            done -= 1
    
    return data

print qsort_loop(data)
||&lt;

&lt;hr>
I was able to do it.
>|python|
# loop
def qsort_loop(data):
    &quot;&quot;&quot;
    ... pivot a b c ... last done ... When
    if a &lt; pivot:
        ... a pivot b c ...
    else:
        ... pivor b c ... last a done ...
        is naive, but there are many copies of this one.
        ... pivor last b c ... a done ...

    &quot;&quot;&quot;
    stack = [(0, len(data))]
    while stack:
        start, end = stack.pop()
        print (start, end)
        if end - start &lt;= 1: continue
        pivot = data[start]
        cur = start + 1
        done = end
        while cur != done:
            v = data[cur]
            #print data
            #print cur, done, pivot, v
            if v &lt; pivot:
                data[cur - 1] = v
                data[cur] = pivot
                cur += 1
            else:
                data[cur] = data[done - 1]
                data[done - 1] = v
                done -= 1

            #print data
            #print
        stack.append((start, cur - 1))
        stack.append((cur, end))
    
    return data

print qsort_loop(data)
||&lt;

first
>||
-        stack.append((start, cur - 1))
-        stack.append((cur, end))
+        stack.append((start, cur))
+        stack.append((cur + 1, end))
||&lt;
The result was usually messed up at the end of the sorting. I added a commented-out print statement to make it a range(5) and followed the flow.

&lt;hr>
Speed Comparison
>|python|
from time import clock

def profile(n):
    print n,
    original_data = range(n)
    shuffle(original_data)
    data = original_data[:]

    t = clock()
    qsort(data)
    print clock() - t,

    data = original_data[:]
    t = clock()
    qsort_loop(data)
    print clock() - t

for i in range(13):
    profile(100 * (2 ** i))
||&lt;

>||
100 0.000448 0.000429
200 0.000967 0.001027
400 0.002129 0.002277
800 0.004327 0.005072
1600 0.00907 0.011751
3200 0.018466 0.022997
6400 0.039396 0.050003
12800 0.085261 0.112591
25600 0.171988 0.224489
51200 0.362911 0.484281
102400 0.767855 1.092627
204800 1.677372 2.279966
409600 3.564921 4.905796
||&lt;

That, that. Surprisingly, the recurrence call is doing well. The recursive version should waste more memory, but I wonder if the high cost of the pointer operation in the loop version is the reason why I can't see it.
&lt;/body>
&lt;comments>
&lt;comment>
&lt;username>nowokay&lt;/username>
&lt;body>You hid it in the sleeve of your clothes! &lt;/body>
&lt;timestamp>1234494606&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>jbking&lt;/username>
&lt;body>Wouldn't zope.interface be fine? &lt;/body>
&lt;timestamp>1234494765&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>nishiohirokazu&lt;/username>
&lt;body>I don't think it's a good idea to reveal the seeds of magic! &lt;/body>
&lt;timestamp>1234496948&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>Delegation&lt;/username>.
&lt;body>I don't think it's overkill, but the above code is hardly practical. For realistic use, it is necessary to support delegation, etc., and then checking the interface becomes mandatory, and it will end up being something like zope.interface. &lt;/body>
&lt;timestamp>1234744318&lt;/timestamp>
&lt;/comment>
&lt;/comments>
</code></pre>
<h2 id="hatena-diary-2009-02-13"><a href="https://nishiohirokazu.hatenadiary.org/archive/2009/02/13" class="external">Hatena Diary 2009-02-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2009-02-13" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2009-02-13" class="external">/nishio/Hatena2009-02-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I’m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>