<!DOCTYPE html>
<html lang="en"><head><title>Hatena2012-05-31</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="Hatena2012-05-31"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2012-05-31"/><meta name="twitter:description" content="hatena &lt;body> *1338449206*Diary failed with SSL dynamic link when trying to install JSX I got the error below, but sudo port upgrade openssl fixed it ..."/><meta property="og:description" content="hatena &lt;body> *1338449206*Diary failed with SSL dynamic link when trying to install JSX I got the error below, but sudo port upgrade openssl fixed it ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1338449206*Diary failed with SSL dynamic link when trying to install JSX I got the error below, but sudo port upgrade openssl fixed it ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2012-05-31"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2012-05-31"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1338449206*Diary failed with SSL dynamic link when trying to install JSX I got the error below, but sudo port upgrade openssl fixed it ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2012-05-31"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Hatena2012-05-31</a></div></nav><h1 class="article-title">Hatena2012-05-31</h1><p show-comma="true" class="content-meta"><span>May 31, 2012</span><span>6 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1338449206*Diary failed with SSL dynamic link when trying to install JSX
I got the error below, but sudo port upgrade openssl fixed it.

>||
JSX[master]$ make setup           
npm install
npm http GET https://registry.npmjs.org/browserbuild
dyld: lazy symbol binding failed: Symbol not found: _SSL_CTX_set_next_proto_select_cb
  Referenced from: /opt/local/bin/node
  Expected in: /opt/local/lib/libssl.1.0.0.dylib

dyld: Symbol not found: _SSL_CTX_set_next_proto_select_cb
  Referenced from: /opt/local/bin/node
  Expected in: /opt/local/lib/libssl.1.0.0.dylib

make: *** [setup] Trace/BPT trap: 5
||&lt;

*1338456208*Get DOM information from JSX using jQuery
Can we use third-party libraries from JSX that don't think anything of static typing, such as jQuery?

Reported because it worked.

I thought it would be more complicated, but it was surprisingly straightforward: the first and last two lines of main do the &quot;get the first p tag with jQuery, get its innerText, edit it as a string, and output it to the console&quot;. The 5 lines of log in between are left for the process of getting to the answer.

>||
import &quot;js.jsx&quot;;
class _Main {
    static function main(args : string[]) : void {
        var jQuery = js.global[&quot;$&quot;] as function(:string):variant;

        log jQuery;
        log jQuery(&quot;p&quot;);
        log (jQuery(&quot;p&quot;) as __noconvert__ Map.&lt;variant>);
        log (jQuery(&quot;p&quot;) as __noconvert__ Map.&lt;variant>)[&quot;0&quot;];
        log ((jQuery(&quot;p&quot;) as __noconvert__ Map.&lt;variant>)[&quot;0&quot;] as Map.&lt;variant>)[&quot;innerText&quot;];

        var value : string = ((jQuery(&quot;p&quot;) as __noconvert__ Map.&lt;variant>)[&quot;0&quot;] as Map.&lt;variant>)[&quot;innerText&quot;] as string;
        log value + &quot;---&quot; + value;
    }
}
||&lt;

A little explanation for those who want to try it out, I compiled this with the name main.js and called it from HTML like below. When you run it, you should see &quot;hoge---hoge&quot; in the console, I checked with Chrome. (PS: I cleaned up the code and put it on github https://github.com/nishio/learning_jsx/tree/master/use_jquery)

>||
&lt;script src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js&quot;>&lt;/script>
&lt;script src=&quot;main.js&quot;>&lt;/script>
&lt;script>
  $(function(){
    _Main$main$AS([]);
  })
&lt;/script>

&lt;p>
hoge
||&lt;

There are four places where I got hooked.

Reposting the code because it is hard to read apart from the code:.
>|javascript|
        var jQuery = js.global[&quot;$&quot;]
            as function(:string):variant;
        var value : string = (((
            jQuery(&quot;p&quot;) as Map.&lt;variant>)
            [&quot;0&quot;] as Map.&lt;variant>)
            [&quot;innerText&quot;] as string);
||&lt;
First of all, the type of a function that takes a string as an argument is function(:string):variant, not function(string):variant.

Second, &quot;Map requires [] operator like [&quot;console&quot;]&quot; by @kazuho

The third is where jQuery(&quot;p&quot;) as Array.&lt;variant> is null. I wonder if this tries to convert it to an Array but fails and becomes null because it is not an Array.

So I added __noconvert__, but then jQuery(&quot;p&quot;) instanceof Array == false, which causes an assertion and calls the debugger. This is the fourth one, and since Map has a fixed key type of string, what should I do with an &quot;Array-like object&quot; that is indexed numerically like jQuery? I often wondered how to do an &quot;Array-like object,&quot; which is indexed numerically like jQuery, but I thought &quot;0&quot; == 0 might work. I tried accessing it with the string &quot;0&quot;, and it worked without any problem. I was happy and satisfied.

So as far as the question &quot;Can I mix JSX with third-party libraries such as jQuery that don't think about static typing? I would say yes without a doubt. Here I used variants and explicit casts to avoid type checking, for example:

https://github.com/jsx/JSX/blob/master/lib/js/js/web.jsx

If you declare a native class Hogehoge in the form of something like &quot;native class Hogehoge&quot; and tell JSX what type of members Hogehoge has, it should go easily. I'll try that next time.

With Google Closure Compiler, you can only use extern declarations like this native class declaration, or you can open a big hole by /** @suppress {checkType} */ for the whole function that uses an uncluttered third-party library. Since the only way to do this is to use a small loophole in the form of a variant or cast, I really like the fact that JSX can create a small loophole in the form of a variant or cast.

Sequel: &lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20120531/1338462986'>Manipulating DOM information from JSX with jQuery Part 2&lt;/a>.

*1338462986* Manipulating DOM information from JSX using jQuery Part 2
I made jquery-1.7.jsx and it looks much better than the version I had cast all by myself earlier.

>||
import &quot;jquery-1.7.jsx&quot;;
class _Main {
    static function main(args : string[]) : void {
        var value : string = jQuery.as_func(&quot;p&quot;).get(0).innerHTML;
        log value + &quot;---&quot; + value;
        jQuery.as_func(&quot;p&quot;).get(1).innerHTML = &quot;piyo&quot;;
    }
}
||&lt;

The first thing that stumped me was that there was no way to define a union type that is both a function and has members. I tried to use jQuery.as_func method to return the casted value as a function. (However, it may not be able to be a native class if it has such a method with an entity.)

Next, what is the return type of $(&quot;p&quot;)? If $(&quot;p&quot;) is x, it must be able to return x[0] and also be able to return x.click. But if I want to make it a class, I can't create a member named 0 or 1... Should I make it a class and create a method named get only for array access?

I was wondering why I was so worried about it when it was already 8:00 p.m., so I'm just going to show you what I've done.
https://github.com/nishio/learning_jsx/tree/master/use_native_class

I wrote &quot;use_native_class&quot; but I haven't used native class yet. And the one in the develop branch seems to get the same thing as $(&quot;p&quot;).css, but for some reason it returns Window when I call it.
https://github.com/nishio/learning_jsx/blob/ac1ffde2d515d4d8a09a94ed3cbac2f023e81569/use_native_class/jquery-1.7.jsx
(PS: Oh, I get it, you took the function and then called it so that this in $(&quot;p&quot;).css points to Window. So casting to Map is a mistake. (Sequel -> &lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20120601/1338479302'>To tell JSX &quot;this object should have foo&quot;&lt;/a>)

I think the problem is that jQuery is too dirty in terms of types. Like the way it says &quot;both a function and an object&quot; just to cut down on the number of characters.
&lt;/body>
&lt;comments>
&lt;comment>
&lt;username>yksoft&lt;/username>
&lt;body>It seems to be undefined---undefined in Firefox.... &lt;/body>
&lt;timestamp>1338458220&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>nishiohirokazu&lt;/username>
&lt;body>I guess you don't put too much emphasis on Firefox support, I heard web.jsx is too heavy to run. &lt;/body>
&lt;timestamp>1338472473&lt;/timestamp>
&lt;/comment>
&lt;/comments>
</code></pre>
<h2 id="hatena-diary-2012-05-31"><a href="https://nishiohirokazu.hatenadiary.org/archive/2012/05/31" class="external">Hatena Diary 2012-05-31<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2012-05-31" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2012-05-31" class="external">/nishio/Hatena2012-05-31<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I’m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>