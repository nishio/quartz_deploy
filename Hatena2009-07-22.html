<!DOCTYPE html>
<html lang="en"><head><title>Hatena2009-07-22</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="Hatena2009-07-22"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2009-07-22"/><meta name="twitter:description" content="hatena &lt;body> *1248243668* Halo in 3D &lt;a href='d.hatena.ne.jp/nishiohirokazu/20090623/1245779090'>Perspective Projection&lt;/a>, &lt;a ..."/><meta property="og:description" content="hatena &lt;body> *1248243668* Halo in 3D &lt;a href='d.hatena.ne.jp/nishiohirokazu/20090623/1245779090'>Perspective Projection&lt;/a>, &lt;a ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1248243668* Halo in 3D &lt;a href='d.hatena.ne.jp/nishiohirokazu/20090623/1245779090'>Perspective Projection&lt;/a>, &lt;a ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2009-07-22"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2009-07-22"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1248243668* Halo in 3D &lt;a href='d.hatena.ne.jp/nishiohirokazu/20090623/1245779090'>Perspective Projection&lt;/a>, &lt;a ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2009-07-22"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Hatena2009-07-22</a></div></nav><h1 class="article-title">Hatena2009-07-22</h1><p show-comma="true" class="content-meta"><span>Jul 22, 2009</span><span>5 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1248243668* Halo in 3D
&lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20090623/1245779090'>Perspective Projection&lt;/a>, &lt;a href='http://d.hatena.ne.jp/nishiohirokazu/20090624/ 1245839434'>Colorization&lt;/a>, continued.

In the previous process, the camera was fixed and only the projection transformation was used, and the objects were placed appropriately within the range of the camera. Let's use a matrix to make the camera move while the objects are fixed.

Use boost::numeric::ublas. I didn't know there were not only matrices but also vectors. I could have used this inner_product for _dot_product that I implemented yesterday. Well, it's not too much trouble to implement it by myself. I don't want to implement matrix multiplication by myself.

&lt;hr>

I was able to do it.
&lt;img src=&quot;http://gyazo.com/90765e8e482533b5d81a57b2fff07fd3.png&quot;>
Sample with spirals on the x, y plane and lines in the z direction.

Stumbling Points:
- Since ublas' outer_prod is an outer product in vectors of general dimensions, the return value is a matrix. I ended up defining the outer product of vectors in 3 dimensions by myself.
- After all, with a single camera matrix, there is no need to make it a 4-dimensional chiral matrix at all, so only the outer and inner products of vectors are used.
Well, this is not the end of what I want to do, I want to do &lt;large area lighting using halo as a light source. Well, let's do it little by little. (PS: According to id:nyaxt, only one diffuse reflection is not called global illumination)

&lt;hr>
It takes about 19 seconds. It's a little off.
&lt;img src=&quot;http://gyazo.com/f8bbca73404acaa38c3671aea47ad22f.png&quot;>
I wonder if the side closer to the origin is shifted to the near side and the far side is shifted to the far side, which means it is distorted by a convex-like nonlinear function downwards. I wonder.

&lt;hr>
I placed parallel objects on the X and Y axes.
Mmm, this!
&lt;img src=&quot;http://gyazo.com/68e8c715caa25037cc1f02334e624e5c.png&quot;>
Ah, I knew it. Only the light source is projected parallel. Correction correction.

&lt;img src=&quot;http://gyazo.com/762cdebcf27ef35f0f3aad1b39e4e415.png&quot;>

This takes about 40 seconds. That's tough because it's on the order of O(nm) for n number of light sources and m number of pixels. There are 400 light sources, and it takes 1 hour to produce a 6000x4200 size image with that many light sources.

*1248244939*Compilation error
>>
matrix.cpp:109: error: no match for ‘operator=’ in ‘camera_left = boost::numeric::ublas::outer_prod(const boost::numeric::ublas::vector_expression&lt;E>&amp;, const boost::numeric::ublas::vector_expression&lt;E2>&amp;) [with E1 = boost::numeric::ublas::vector&lt;double, boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> > >, E2 = boost::numeric::ublas::vector&lt;double, boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> > >](((const boost::numeric::ublas::vector_expression&lt;boost::numeric::ublas::vector&lt;double, boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> > > >&amp;)((const boost::numeric::ublas::vector_expression&lt;boost::numeric::ublas::vector&lt;double, boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> > > >*)((boost::numeric::ublas::vector_expression&lt;boost::numeric::ublas::vector&lt;double, boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> > > >*)(&amp; camera_up)))))’
/opt/local/include/boost/numeric/ublas/vector.hpp:159: note: candidates are: boost::numeric::ublas::vector&lt;T, A>&amp; boost::numeric::ublas::vector&lt;T, A>::operator=(const boost::numeric::ublas::vector&lt;T, A>&amp;) [with T = double, A = boost::numeric::ublas::unbounded_array&lt;double, std::allocator&lt;double> >]
&lt;&lt;
There's something like a pretty repetitive structure, so if you map this to sound, you can make a melody! (Yes!)

*1248274085* Painting of the Day
Perhaps because white is an expansion color and black is a contraction color, just by inverting the image, the impression changes considerably. Well, it is not just a simple inversion, but I heard that it is difficult to see that the inside of the ring has been removed, so I made the inside of the ring alpha.

&lt;img src=&quot;http://gyazo.com/265f33b31e4afb55102296dc4d48b28f.png&quot;>

Uploads on e-mobile are slow. I think I'll go to McDonald's tomorrow and try bbmobile.

&lt;hr>

I am making data for A4 printing. I usually just implement an idea, confirm that it works as expected, and post it on my blog called gyazo, so I have no data for printing. I don't even have enough data to print an A4 photo, so I'm going to make it. I'm not sure if I can get it to print now in time for Tuesday morning. I'm planning to bring it to the lunch meeting on Tuesday.

&lt;img src=&quot;http://gyazo.com/da272e9c173b420d145adb3368948045.png&quot;>

&lt;hr>

It's all grayscale!
&lt;img src=&quot;http://gyazo.com/161d4d73031cf22d08ffdb3577c630d9.png&quot;>

*1248279889*Use GIL
Giant Interpreter Lock is used for (wrong)

I'm thinking of reorganizing my own canvas library since it's getting a bit messed up. I was just saying that, when id:nyaxt said to me, &quot;Why don't you just use boost::gil? I didn't know that! I didn't know there was such a thing! I didn't have to do the libpng thing myself!

So references: &lt;a href='http://www.kmonos.net/alang/boost/classes/gil.html'>letsboost::gil&lt;/a>, &lt;a href='http://sssm.sakura.ne.jp/dev/gil .html'>Using the Adobe Generic Image Library (GIL)&lt;/a> &lt;a href='http://sites.google.com/site/twinkleofsilence/japanese-translation-of-gil- tutorial'>Generic Image Library Tutorial Japanese translation &amp;#8206;(Twinkle of Silence)&amp;#8206;&lt;/a>

You will see similarities between view and image, but image is a container for pixels; creating an image allocates memory, and copying an image consumes more memory. The various algorithms basically deal with views, which are not containers but references to groups of pixels. Copying is not heavy.

Wow. There is something like an iterator for pixels? It's not only horizontal, but also vertical scanning is available.

Library tutorial www. where the words &quot;memory access pattern&quot; and &quot;cache friendly&quot; are used.

>planar-type pixels have channels that are arranged discontinuously in memory. The reference is a proxy class that uses a color base with color elements as channel iterators.

I see!

*1248284792*Diary
Yeah, I don't feel sleepy in any way, but I'm not motivated to get any work done, look at Twitter, etc. I must be sleepy. I thought I made the global lighting renderer yesterday, but it's today.

I also want to organize my library, but before I do that, I have a couple of images that need to be created quickly. I have a lot of work to do. Motivation is the problem.
&lt;/body>
</code></pre>
<h2 id="hatena-diary-2009-07-22"><a href="https://nishiohirokazu.hatenadiary.org/archive/2009/07/22" class="external">Hatena Diary 2009-07-22<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2009-07-22" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2009-07-22" class="external">/nishio/Hatena2009-07-22<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I’m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>