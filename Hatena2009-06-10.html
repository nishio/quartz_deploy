<!DOCTYPE html>
<html lang="en"><head><title>Hatena2009-06-10</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="🪴 Quartz 4.0"/><meta property="og:title" content="Hatena2009-06-10"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2009-06-10"/><meta name="twitter:description" content="hatena &lt;body> *1244605798*Complexity Debugging a Python script that spits out a complete minimum hash in C++ is coming to a climax. The minimum hashing of the giraffe arrangement does not give the correct value when one of the pieces is a holding."/><meta property="og:description" content="hatena &lt;body> *1244605798*Complexity Debugging a Python script that spits out a complete minimum hash in C++ is coming to a climax. The minimum hashing of the giraffe arrangement does not give the correct value when one of the pieces is a holding."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1244605798*Complexity Debugging a Python script that spits out a complete minimum hash in C++ is coming to a climax. The minimum hashing of the giraffe arrangement does not give the correct value when one of the pieces is a holding."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2009-06-10"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2009-06-10"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1244605798*Complexity Debugging a Python script that spits out a complete minimum hash in C++ is coming to a climax. The minimum hashing of the giraffe arrangement does not give the correct value when one of the pieces is a holding."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2009-06-10"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">🪴 Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ❯ </p></div><div class="breadcrumb-element"><a href>Hatena2009-06-10</a></div></nav><h1 class="article-title">Hatena2009-06-10</h1><p show-comma="true" class="content-meta"><span>Jun 10, 2009</span><span>6 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1244605798*Complexity
Debugging a Python script that spits out a complete minimum hash in C++ is coming to a climax. The minimum hashing of the giraffe arrangement does not give the correct value when one of the pieces is a holding. I'll try to write the problem down to get my head around it.

Let's make it the smallest pattern to reproduce the problem, Unordered(And(Or(Choice(3), Choice(1)), Choice(2)))), and let's name the variables three, two, and one for Choice's 3, 2, and 1, respectively. In this case, first, And(Or(...)) The next step is to rewrite the pattern to make it into Or(And(three, two), And(one, two)). Next, the rewriting pattern of Unordered(Or(...)) by the rewriting pattern
>|python|
Or(
  Or(
    Unordered(And(three, two)),
    Unordered(And(one, two))
  ),
  And(
    And(three, two),
    And(one, two)
  )
)
||&lt;
It goes like this.
This outer Or range is working fine. The problem is the second half. Let's look at the source for the relevant part of the integer to phase decoder
>|cpp|
    }else{
        // And(And(Choice(3), Choice(2)), And(Choice(1), Choice(2)))
        is_choice2_1 = false;
        and2 = or3 - 24;
        and0 = and2 / 2;
        and1 = and2 % 2;
        // And(Choice(3), Choice(2))
        choice1 = and0 / 2;
        choice0 = and0 % 2;
        // Choice(3)
        three = choice1;
        // Choice(2)
        two = choice0;
        // And(Choice(1), Choice(2))
        choice2 = and1 / 2;
        choice0 = and1 % 2;
        // Choice(1)
        one = choice2;
        // Choice(2)
        int two2 = choice0; // HERE
        if(is_choice2_0){
            three_1 = three;
            two_1 = two;
            one_0 = one;
            two_0 = two2; // HERE
        }else{
            three_0 = three;
            two_0 = two;
            one_1 = one;
            two_1 = two2; // HERE
        }
||&lt;
The part marked HERE was fixed by hand. The original was &quot;two&quot;, which means that if there are variables with the same name in X and Y of Unordered(Or(X, Y)), they will collide and overwrite each other.

&lt;hr>

I wrote it and took a walk and found out! The if(is_choice2_0) was originally put together to equate when the encoder is (ture, false) and when it is (false, true), and I put it on the decoder as a reverse conversion without thinking too much about it, but first of all The decoder doesn't need a branch (because it only needs to return one of the two).
Also, although it is done together at the end, // if three_1 = three; two_1 = two; immediately after And(Choice(1), Choice(2)), it doesn't hurt or itch if two is overwritten in the subsequent process.

The fundamental problem is doing it all together at the end. OK, let's fix it.

The Python code looks something like this
>|python|
    result += Renderer.multiline_if(
        oname + &quot;_0&quot;,
        [Renderer.assign(v + &quot;_1&quot;, v) for typ, v, com in self.r1.args] +
        [Renderer.assign(v + &quot;_0&quot;, v) for typ, v, com in self.r2.args],
        [Renderer.assign(v + &quot;_0&quot;, v) for typ, v, com in self.r1.args] +
        [Renderer.assign(v + &quot;_1&quot;, v) for typ, v, com in self.r2.args])
||&lt;

And, of course, the encoder has the same problem.
>|cpp|
        if(is_choice2_1){
            three = three_0;
            two = two_0;
            one = one_1;
            two = two_1;
        }else{
            three = three_1;
            two = two_1;
            one = one_0;
            two = two_0;
        }
||&lt;

&lt;hr>

Fixed! OK, test passed!

&lt;hr>

I attacked the last boss at once, but the test failed. There are some negative values. I'll cut it down as much as possible to reproduce the problem.

&lt;hr>
It is considerably smaller.

>|python|
    All = And(
        Unordered(
            Or(
                Choice(2, &quot;foo&quot;),
                Choice(1, &quot;bar&quot;),
                &quot;is_bar&quot;)
            ),
        Choice(2, &quot;baz&quot;))
||&lt;
If you test this (0 is fail)
>||
111111110000
||&lt;
>||
1@0(0): 1, 1, 0, 0, 0, 12345, 12345, 
1@1(1): 1, 1, 0, 0, 1, 12345, 12345, 
1@2(2): 0, 1, 12345, 12345, 0, 0, 0, 
1@3(3): 0, 1, 12345, 12345, 1, 0, 0, 
1@4(4): 0, 1, 12345, 12345, 0, 0, 1, 
1@5(5): 0, 1, 12345, 12345, 1, 0, 1, 
1@6(6): 0, 1, 12345, 12345, 0, 1, 1, 
1@7(7): 0, 1, 12345, 12345, 1, 1, 1, 
0@8(49388): 1, 0, 12345, 0, 0, 0, 12345, 
0@9(49389): 1, 0, 12345, 0, 1, 0, 12345, 
0@10(49388): 1, 0, 12345, 0, 0, 1, 12345, 
0@11(49389): 1, 0, 12345, 0, 1, 1, 12345, 
||&lt;
It's kind of overflowing (12345 is an undef alternative).
So for now, we can just follow when i = 8.

Well, the encoder's conditional branch is wrong, and it is picking up the undef value. I don't know how this worked until now.

&lt;hr>
OK, got it; Unorder(Or(...)) is rewritten to become Or(Or(Unordered(.....)))) then Or has a &quot;flag rewritten by Unordered&quot;, but when And(Or(...)) When rewriting Or(And(Or(...))) does not inherit that flag when it is rewritten to I fixed it and the little child test passes. I tried the last boss after all....

>||
1@59(59): 0, 0, 12345, 12345, 0, 2, 3, 3, 
1@60(60): 0, 1, 12345, 0, 0, 12345, 1, 1, 
1@61(61): 0, 1, 12345, 0, 0, 12345, 1, 2, 
1@62(62): 0, 1, 12345, 0, 0, 12345, 1, 3, 
1@63(63): 0, 1, 12345, 0, 0, 12345, 2, 2, 
1@64(64): 0, 1, 12345, 0, 0, 12345, 2, 3, 
1@65(65): 0, 1, 12345, 0, 0, 12345, 3, 3, 
0@66(-1610694590): 0, 1, 12345, 0, 0, 12345, 65541, -2147385340, 
0@67(-1610792896): 0, 1, 12345, 0, 0, 12345, 65541, -2147385339, 
0@68(-1610891203): 0, 1, 12345, 0, 0, 12345, 65541, -2147385338, 
0@69(-1610989511): 0, 1, 12345, 0, 0, 12345, 65541, -2147385337, 
1@70(70): 0, 1, 12345, 1, 0, 12345, 1, 1, 
1@71(71): 0, 1, 12345, 1, 0, 12345, 1, 2, 
1@72(72): 0, 1, 12345, 1, 0, 12345, 1, 3, 
1@73(73): 0, 1, 12345, 1, 0, 12345, 2, 2, 
1@74(74): 0, 1, 12345, 1, 0, 12345, 2, 3, 
1@75(75): 0, 1, 12345, 1, 0, 12345, 3, 3, 
0@76(-1610694580): 0, 1, 12345, 1, 0, 12345, 65541, -2147385340, 
0@77(-1610792886): 0, 1, 12345, 1, 0, 12345, 65541, -2147385339, 
0@78(-1610891193): 0, 1, 12345, 1, 0, 12345, 65541, -2147385338, 
0@79(-1610989501): 0, 1, 12345, 1, 0, 12345, 65541, -2147385337, 
1@80(80): 0, 1, 12345, 0, 1, 12345, 0, 0, 
||&lt;
If we look at the last two numbers, we see 1,1 1,2 1,3 2,2 2,3 2,3 3,3, coming to four garbage in.

*1244620423* Does it make sense to keep the &quot;idea&quot; to yourself?
&lt;a href='http://d.hatena.ne.jp/kawango/20090605/1244190501'>He who wants to keep his ideas to himself - A diary that won't die until he uses up his 30,000 Hatena points&lt;/a> via id:takano32
>>
If the idea is truly groundbreaking, the background knowledge and experience will be different from others, and you will never be understood when you talk about it.
&lt;&lt;

Interesting point of view.

*1244640773* [Inkscape] drawing

It's a mysterious object.
&lt;img src=&quot;http://gyazo.com/d28bf72dd5be4551930e5454f08269ab.png&quot;>

&lt;/body>
</code></pre>
<h2 id="hatena-diary-2009-06-10"><a href="https://nishiohirokazu.hatenadiary.org/archive/2009/06/10" class="external">Hatena Diary 2009-06-10<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2009-06-10" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2009-06-10" class="external">/nishio/Hatena2009-06-10<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I’m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> © 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>