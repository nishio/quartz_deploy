<!DOCTYPE html>
<html lang="en"><head><title>Hatena2013-03-13</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ğŸª´ Quartz 4.0"/><meta property="og:title" content="Hatena2013-03-13"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2013-03-13"/><meta name="twitter:description" content="hatena &lt;body> *1363167178* Automatic generation of tests for code with state I implemented the BLUE* algorithm, so I went ahead and did the automatic test generation ..."/><meta property="og:description" content="hatena &lt;body> *1363167178* Automatic generation of tests for code with state I implemented the BLUE* algorithm, so I went ahead and did the automatic test generation ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1363167178* Automatic generation of tests for code with state I implemented the BLUE* algorithm, so I went ahead and did the automatic test generation ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2013-03-13"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2013-03-13"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1363167178* Automatic generation of tests for code with state I implemented the BLUE* algorithm, so I went ahead and did the automatic test generation ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2013-03-13"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">ğŸª´ Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> â¯ </p></div><div class="breadcrumb-element"><a href>Hatena2013-03-13</a></div></nav><h1 class="article-title">Hatena2013-03-13</h1><p show-comma="true" class="content-meta"><span>Mar 13, 2013</span><span>6 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1363167178* Automatic generation of tests for code with state
I implemented the BLUE* algorithm, so I went ahead and did the automatic test generation.

The specification of the code to be tested this time is
- Open, close, and write.
- If I write or close it without opening it, I get an error.
something like ...

And here is a &quot;buggy implementation&quot; of it:

>|python|
class Target(object):  # bad impl.
    def __init__(self):
        self.opened = False
        self.closed = False

    def open(self):
        self.opened = True

    def write(self):
        if not self.opened:
            raise RuntimeError
        if self.closed:
            raise RuntimeError

    def close(self):
        if not self.opened:
            raise RuntimeError
        self.closed = True
||&lt;

First, write the test manually. e_plus is &quot;operation that should not result in an error,&quot; e_minus is &quot;operation that should result in an error,&quot; and open, close, and write are abbreviated as o, c, and w, respectively.

>||
e_plus = ['o', 'oc', 'ow', 'owc', 'oww', 'owwc', 'owww']
e_minus = ['c', 'w', 'ocw']
||&lt;

When this test is fed to BLUE*, a DFA is created that satisfies the condition.

[f:id:nishiohirokazu:20130313181238p:image]

Generate a test case for this with a breadth-first search, feed it to both the DFA and the actual implementation, and look for different results.

First, I found a mismatch on the fourth candidate: when I open and re-open it, the DFA claims that it should be an error, but the implementation says that it is not. Yeah, that is not clearly stated in the spec. In this case, we will assume that it should be an error. Let's add that to the spec and fix the implementation.

>||
4: for input ['o', 'o']: dfa said False, but target said True
||&lt;

Fix implementation.
>|python|
    def open(self):
        if self.opened:
            raise RuntimeError
        self.opened = True
||&lt;

Ran it again. This time a mismatch was found in the 8th candidate. According to the report, &quot;If you open, close, and then close again, DFA expected an error, but the implementation does not. The specification does not specify whether it should be an error when closing something that has been closed again. We will determine that this should be an error and correct the implementation.

>||
8: for input ['o', 'c', 'c']: dfa said False, but target said True
||&lt;

I'm sure those with good instincts have noticed that you only want to manage two states, &quot;open or not open,&quot; so there's no need for a flag called closed.

>|python|
class Target(object):
    def __init__(self):
        self.opened = False

    def open(self):
        if self.opened:
            raise RuntimeError
        self.opened = True

    def write(self):
        if not self.opened:
            raise RuntimeError

    def close(self):
        if not self.opened:
            raise RuntimeError
        self.opened = False
||&lt;

The implementation was corrected and the search was run again.

This time, &quot;If you open and then close and then open, DFA expected an error, but the implementation does not. The spec doesn't even specify if it's closed and then opened again. The spec should say that this can be opened. In other words, this is wrong on the part of DFA. In cases like this, I would add to e_plus to tell them, &quot;That's correct that it's not an error.

>||
7: for input ['o', 'c', 'o']: dfa said False, but target said True
||&lt;

He thought ocoo was going to succeed, but this is correct to make an error. I'll add this to e_minus to tell him that &quot;it's right to make an error&quot;.
>||
13: for input ['o', 'c', 'o', 'o']: dfa said True, but target said False
||&lt;

The implementation of this is also correct.
>||
16: for input ['o', 'w', 'c', 'o']: dfa said False, but target said True
||&lt;

The implementation of this is also correct.
>||
34: for input ['o', 'w', 'w', 'w', 'o']: dfa said True, but target said False
||&lt;

Then the search program reports &quot;No mismatches were found for input columns of length 20 or less. Congratulations, we are happy.

If I had simply tested for sequences of less than 20 operations, there would have been 3 ** 20, or 3486784401 operations, but here I only need 53130 because I don't search beyond the path that causes the error. That's 60,000 times faster than testing randomly without thinking. On the other hand, as for the human description, there are 9 positive tests and 5 negative tests, which means that about 4000 times more tests are generated from the description.

This is what the DFA looks like at this time. If a human wrote it, I think he would stick 3 and 5 together, but, well, he's not wrong.
[f:id:nishiohirokazu:20130313182644p:image]

In this case, there is no noise in the input, but BLUE* itself is an algorithm for how to estimate DFA from a noisy column, so I would like to use it in a noisy example in the near future.

References
- &quot;BLUE*: a Blue-Fringe Procedure for Learning DFA with Noisy Data&quot; by M Sebban, J Janodet, F Tantini
- &quot;From Test Cases to FSMs: Augmented Test-driven Development and Property Inference&quot;  by Thomas Arts and Simon Thompson
&lt;/body>
&lt;comments>
&lt;comment>
&lt;username>shiracha&lt;/username>
&lt;body>Is this a kind of model checker? &lt;br>I think it's an interesting direction to take, as it shows only a part of the model and infers the rest of the model behavior. &lt;br>The question is, where did you come up with this idea? &lt;/body>
&lt;timestamp>1363275174&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>nishiohirokazu&lt;/username>
&lt;body>I've added a bibliography. I've only done a cursory read though. &lt;/body>
&lt;timestamp>1363316521&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>seizans&lt;/username>
&lt;body>Midway &lt;br>> says &quot;If you open, close, and then close again, DFA expected an error, but the implementation doesn't.&quot; &lt;br>> The spec doesn't specify if you can open it again after closing it. I don't think the two statements in &lt;br> are occluded. &lt;BR>I guess if open -> close -> close, then whether it can be closed again after closing? &lt;br>&lt;br>And I don't have a proper grasp of the details and what kind of DFA I should be able to do, but &lt;br>This is what the DFA looks like at this time. If a human wrote it, I would probably stick 3 and 5 together, but I'm not wrong. &lt;br>Wouldn't this attach 1, 3, and 5 if a human wrote it? &lt;/body>
&lt;timestamp>1365864444&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>nishiohirokazu&lt;/username>
&lt;body>>>> says: &quot;If you open, close, and then close again, DFA expected an error, but the implementation does not. &lt;br>>> The spec doesn't specify if you can open it again after closing it. I don't think the two statements &lt;br>>are occluded. &lt;BR>&lt;BR>You are right, I think I was mixing up the description of the next test. I have corrected it! &lt;BR>&lt;BR>Wouldn't this stick 1, 3 and 5 together if written by a human? &lt;BR>&lt;BR>Yes, and it is also wrong that 0 is a non-accepted state, and if you write a clean DFA that includes that, it should be a DFA with only two states: &quot;closed&quot; and &quot;open&quot;. &lt;/body>
&lt;timestamp>1365867023&lt;/timestamp>
&lt;/comment>
&lt;/comments>
</code></pre>
<h2 id="hatena-diary-2013-03-13"><a href="https://nishiohirokazu.hatenadiary.org/archive/2013/03/13" class="external">Hatena Diary 2013-03-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2013-03-13" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2013-03-13" class="external">/nishio/Hatena2013-03-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. Iâ€™m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> Â© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>