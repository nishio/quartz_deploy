<!DOCTYPE html>
<html lang="en"><head><title>Hatena2008-07-12</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ü™¥ Quartz 4.0"/><meta property="og:title" content="Hatena2008-07-12"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2008-07-12"/><meta name="twitter:description" content="hatena &lt;body> *1215836819*ICFP Diary www.icfpcontest.org/ (Write gradually) First of all, I would like to mention that the contest has already started and those who intend ..."/><meta property="og:description" content="hatena &lt;body> *1215836819*ICFP Diary www.icfpcontest.org/ (Write gradually) First of all, I would like to mention that the contest has already started and those who intend ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1215836819*ICFP Diary www.icfpcontest.org/ (Write gradually) First of all, I would like to mention that the contest has already started and those who intend ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2008-07-12"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2008-07-12"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1215836819*ICFP Diary www.icfpcontest.org/ (Write gradually) First of all, I would like to mention that the contest has already started and those who intend ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2008-07-12"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">ü™¥ Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href>Hatena2008-07-12</a></div></nav><h1 class="article-title">Hatena2008-07-12</h1><p show-comma="true" class="content-meta"><span>Jul 12, 2008</span><span>8 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1215836819*ICFP Diary
http://www.icfpcontest.org/

(Write gradually)

First of all, I would like to mention that the contest has already started and those who intend to try their best have already begun to do so. My purpose is to experience what ICFP is all about and to write an introductory entry in Japanese, so I will update this blog slowly while doing household chores.

-----

Took empty cans to recycling bin. Hot. Hot. Hot.

I've set up a water-drizzled barley tea.

Well, for now, an explanation of the rules, etc. See more at: http://www.icfpcontest.org/rules.html
No pre-registration is required, just complete and submit your source code by July 14 (PDT) Team size is limited to 5 people, with no age or student requirement. Discussions with other teams are allowed, but sharing of code is not.

I heard that there will be $1000 for the grand prize, $500 for the best submission in the first 24 hours, and $500 for the judges' special prize, but I'm not going to do my best, so I'm not going to go through with it.

The default languages available are listed at the end of http://www.icfpcontest.org/live-cd.html, but if you want to use a language other than this, you can send pre-compiled binaries or other binaries you need along with the source. The same environment as the organizer's is distributed as 1CD Linux, so those who want to send binaries will have to use that. Well, I plan to use Python, so it doesn't matter.

-----

I had to vacuum up the annoying little flies around the monitor. The machine is acting up, so I'm going to reboot it.

-----

I hung the laundry out to dry, but I can hear the thunder. An evening shower is coming, I'm sure.


Wow, lightning struck, and it was pretty close! The sound was sharp!

-----

Okay, now then, let's get to the explanation of the key problem statement. This time, the problem is to control a Mars rover. Of course, it's not a real one, so you can think of it as &quot;playing the Mars Exploration Game.&quot; Instead of a human playing it, we create a program to play it. This is the challenge.

Details: http://smlnj.org/icfp08-contest/task.html

The objective of the game is to control the Mars rover to get to the destination. There are craters and big rocks on the map, so you have to avoid them. Moreover, there are Martians, and if the rover is caught by a Martian, it will be destroyed immediately and the game will be over.

The formula below determines if you played the game well (the smaller the better)
- If the goal is reached within the time limit, the time t (in milliseconds)
- If the goal is not reached within the time limit n, n + 100
- If destroyed by Martians at time t, 2n - t + 600
- If you fall into the crater at time t, 2n - t + 1000

 As you can see from the -t in the box, the score is higher if you run around as much as possible even if you are sure that the Martian will catch you. Also, if the Martian is chasing you and you are about to fall into a crater, the score is higher if the Martian catches you. Well, of course it is best to reach the goal.

-----

I had to sudo port install gmp to get the simulator placed at http://smlnj.org/icfp08-contest/simulator.html to work.

-----

Well, actually, after reading the problem in detail, it is getting tedious, but, well, let's just try a little harder. If you start the server you downloaded from the link above
>||
$ ./server -v sample-maps/simple-small.wrld 
waiting for client connection on port 17676
||&lt;
The output will be &quot;1&quot; and the program will be in standby mode. At the very least, we need a program that connects to the specified port and communicates with it. So, for now, let's connect to the specified port and try to read it. Incidentally, the final submission says that the hostname must be able to be specified, so I included that as an option.

>|python|
import sys
HOSTNAME = sys.argv[1]
PORT = int(sys.argv[2])

import socket
s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect((HOSTNAME, PORT))
print s.recv(1024)
s.close()
||&lt;

Let's run it. Oh, the GUI started up. And it closed in about 1 second.
output (result)
>||
I 200.000 200.000 30000 30.000 60.000 20.000 20.0 60.0 ;

Call from C to SML raised exception.
unhandled exception: Fail: EOF
(hereinafter abbreviated)
||&lt;

I was going to parse it while looking at 3.1 Messages from the server to the controller, but that's not a &quot;minimum requirement&quot; so I held off (yeah).
Let's just let it run without thinking about it.

>|python|
while 1:
    print s.recv(1024)
    s.send(&quot;ar;&quot;)
||&lt;

&lt;img src=&quot;http://gyazo.com/e4689b56f384031cf0ac4653d06cb139.png&quot;>

Oh, it's spinning! Just to explain, the program prints all the messages sent from the server, ignores them, and just keeps shouting &quot;spin around! and keep on shouting &quot;Turn! Incidentally, it switches to &quot;acceleration mode&quot; just by sending &quot;a&quot; once, so there is no point in sending it again and again.


Now, I tried it because ANEMO said, &quot;If it's just a random run, you can do it in 15 minutes,&quot; and yes, if it's just a random run, you can do it in 15 minutes. If it's purely coding time. If you include the time to read the documentation, it's a bit impossible unless you can read English fast. It's interesting to see a probe running around with my code.

-----

&lt;img src=&quot;http://gyazo.com/5e21ec10e57a5af4e65015bcad86a4bf.png&quot;>
Oh, and there are enemies.

-----

I guess ML languages are the easiest to write a parser for this kind of thing. Among the languages I've used so far, writing in Haskell seems to be the easiest. However, I don't want to look up how to do sockets in Haskell, so I'm not going to do it.
I wonder what is the easiest way to write this kind of parsing in Python. Or is it faster to just do it by hand instead of thinking about it? I used named groups of regular expressions in LL Ring's Janken 2.0, but this protocol is clearly designed to &quot;pass through a space-delimited tokenizer,&quot; so I used a space-delimited tokenizer for now. I used space delimited. Now, let's see.

-----

I find myself wanting to write pattern-matching code for Python, not caring about ICFP or anything else, but I persevered and wrote it anyway.
The telemetry perspective looks like this.
>|python|
def telemetry(xs):
    &quot;&quot;&quot;T time-stamp vehicle-ctl vehicle-x vehicle-y vehicle-dir vehicle-speed objects ;&quot;&quot;&quot;
    keys = &quot;&quot;&quot;time_stamp vehicle_ctl 
              vehicle_x vehicle_y 
              vehicle_dir vehicle_speed&quot;&quot;&quot;.split(),

    memory.__dict__.update(zip(keys, take(xs, 6)))

    objects = []
    enemies = []
    while True:
        typ = xs.pop(0)
        if typ == &quot;;&quot;:
            break
        if typ == &quot;m&quot;:
            # m enemy-x enemy-y enemy-dir enemy-speed
            enemies.append(take(xs, 4))
        else:
            # object-kind object-x object-y object-r 
            objects.append((typ, tuple(take(xs, 3))))

    memory.enemies = enemies # latest data only
    memory.objects.update(objects) # keep unique (it is a set)
||&lt;

I'm getting bored (again).
If the time limit is too long, I get bored in the middle of the game, and I guess one of the reasons is that I'm doing it alone in my room. It might be fun if a few of us got together and had a good time.


And for now, let's hold off on looking away and make it to the finish line on the smallest map. Otherwise, I'm afraid I'll just throw it away.

-----

>|python|
>>> map(apply, [int, str, float], &quot;1 1 1&quot;.split())
[1, '1', 1.0]
||&lt;
Hmm.

>|python|
>>> [f(x) for f, x in zip([int, str, float], &quot;12 34 56&quot;.split())]
[12, '34', 56.0]
||&lt;
Hmm.

-----

At any rate, I tried to reach the goal without thinking about it.

>|python|
    from math import sin, cos, pi
    rdir = dir / 180 * pi # radian
    speed = 1
    dx = speed * cos(rdir)
    dy = speed * sin(rdir)
    cp = -x * dy + y * dx
    print x, y, dx, dy
    if cp > 0:
        s.send(&quot;ar;&quot;)
    else:
        s.send(&quot;al;&quot;)
||&lt;

I really don't think about anything, I just keep pushing toward the goal. And since the angle goes too far and then back again, he wobbles along, shaking his head. Cute!
To avoid wobbling, I need to try to calculate my current angular velocity and then the angular acceleration when I am turning.

But that's not the minimum. Should the priority be not falling into a crater? No, but I still need to know how fast I am spinning.

-----

Ahhh. B 777;T ... when a collision occurs ... ;; so I guess a simple space delimiter won't do.

-----

I've tried to calculate the angular velocity. I should create an internal model to simulate where my position will be if I keep going, but it's too much of a hassle.
&quot;If we were going at this speed, we wouldn't be able to dodge the crater!&quot; If you don't make a decision, you can't avoid the crater. But it's a pain in the ass.
&lt;/body>
&lt;comments>
&lt;comment>
&lt;username>inajob&lt;/username>
&lt;body>Trying with seniors in the lab. It's fun, but it's going to be very troublesome later on&lt;/body>.
&lt;timestamp>1215874617&lt;/timestamp>
&lt;/comment>
&lt;/comments>
</code></pre>
<h2 id="hatena-diary-2008-07-12"><a href="https://nishiohirokazu.hatenadiary.org/archive/2008/07/12" class="external">Hatena Diary 2008-07-12<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2008-07-12" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2008-07-12" class="external">/nishio/Hatena2008-07-12<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I‚Äôm very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> ¬© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>