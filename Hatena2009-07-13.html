<!DOCTYPE html>
<html lang="en"><head><title>Hatena2009-07-13</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ü™¥ Quartz 4.0"/><meta property="og:title" content="Hatena2009-07-13"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2009-07-13"/><meta name="twitter:description" content="hatena &lt;body> *1247458741*Electronics Workshop (summary) see also: d.hatena.ne.jp/inajob/20090712, d.hatena.ne.jp/tgbt/20090713/1247500951, www16.atwiki.jp/tokoroten/pages/1166.html ..."/><meta property="og:description" content="hatena &lt;body> *1247458741*Electronics Workshop (summary) see also: d.hatena.ne.jp/inajob/20090712, d.hatena.ne.jp/tgbt/20090713/1247500951, www16.atwiki.jp/tokoroten/pages/1166.html ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1247458741*Electronics Workshop (summary) see also: d.hatena.ne.jp/inajob/20090712, d.hatena.ne.jp/tgbt/20090713/1247500951, www16.atwiki.jp/tokoroten/pages/1166.html ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2009-07-13"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2009-07-13"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1247458741*Electronics Workshop (summary) see also: d.hatena.ne.jp/inajob/20090712, d.hatena.ne.jp/tgbt/20090713/1247500951, www16.atwiki.jp/tokoroten/pages/1166.html ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2009-07-13"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">ü™¥ Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> ‚ùØ </p></div><div class="breadcrumb-element"><a href>Hatena2009-07-13</a></div></nav><h1 class="article-title">Hatena2009-07-13</h1><p show-comma="true" class="content-meta"><span>Jul 13, 2009</span><span>7 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1247458741*Electronics Workshop (summary)
see also: http://d.hatena.ne.jp/inajob/20090712, http://d.hatena.ne.jp/tgbt/20090713/1247500951, http://www16.atwiki.jp/tokoroten/pages/1166.html
Had an electronics festival with id:tgbt, id:inajob, id:nyaxt, id:TOKOROTEN, &lt;a href=&quot;http://www.mbin.jp/~masa-u/&quot;>masa-u&lt;/a> and others.

Made available: http://www.youtube.com/watch?v=Segch217C0w

I had only decided to &quot;make something that makes sound for now,&quot; but before I knew what it was, I had to buy a sound source chip or something like that. Yamaha sound source IC (YMZ294) for 500 yen.

I started with an Atmega168 from &lt;a href='http://ja.wikipedia.org/wiki/Atmel_AVR'>Atmel AVR&lt;/a>, an FT232RL USB serial conversion module (950 yen), and a breadboard to make an Arduino-compatible board. The breadboard was a puzzle. The breadboard was a puzzle.

I tested it with the power supply. It worked! It seems that the Arduino bootloader was burned into the AVR by Mr. masa-u in advance. Maybe.

f:id:nishiohirokazu:20090711200722j:image

The top right corner is the USB serial converter circuit, and from there it is properly wired to the AVR. The silver component is a crystal oscillator, which goes into the AVR's 9 and 10 XTAL (crystal) legs, and GND and VCC are connected to both in the same way since there are two for some reason. Also, connect TXD and RXD for transmitting and receiving to the USB serial circuit.

&lt;img src=&quot;http://gyazo.com/6cb3795be2e8166bd6bca7c61a4c6862.png&quot;>
f:id:nishiohirokazu:20090713133114j:image

Now that it works, the next step is to install the development environment and other things. Well, if you go to the official Arduino website and read Getting Started, you can find all about it.

I quickly rewrote the program to blink the LEDs. The sample code to make the LEDs blink is included, so just follow it: &lt;a href='http://arduino.cc/en/Tutorial/Blink'>Arduino - Blink&lt;/a>.

Now writing. However, there is no change in behavior. After much trouble, I found that the wiring was wrong, and that TXD and RXD were off by one square, so that &quot;a program that has already been written can be executed by receiving power supply, but a new program cannot be written. Fixed.

Now that we have a blinking LED, the next step is to try PWM (Pulse Width Modulation, &lt;a href='http://ja.wikipedia.org/wiki/%E3%83%91%E3%83%AB%E3%82%B9%E5%B9%85%E5%A4%89%E8%AA%BF Pulse Width Modulation, &lt;a href=''>Pulse Width Modulation&lt;/a>) is the next challenge. The documentation is well written, so I just followed the instructions. I got an LED that blinks like a firefly.

The next step is to build an amplifier to produce sound, apparently an LM368 chip. I was told, &quot;Go to the website and read the datasheet. I was told to &quot;go to the web and read the datasheet and apply for what you need&quot;, so id:inajob and I read it together. The minimum configuration seems to be sufficient, so we applied for three parts: 250 microF, 0.05 microF, and 10 ohms. The parts I received are 220microF, 0.1microF, and the resistor is, let's see, brown-green-black-gold, so I guess 15 ohms.

f:id:nishiohirokazu:20090713140403j:image
The top is a schematic close to what was written in the document. Below is a schematic close to the actual assembly.
&lt;img src=&quot;http://gyazo.com/f268f7ae6437142af227a8c82f9c3a0d.png&quot;>
Circuit photo.

Now that the amp is ready, let's start pouring something into it. I tried &quot;Why don't you put the signal of this LED, which is adjusting brightness by PWM, into the sound input?

After about three hours from the start of the event, everyone was getting hungry, so we cleaned up and had dinner. I watch Uenotan eat a lot.

I connected a pushbutton switch and wrote a code that says &quot;the sound only comes on while you press it&quot;, but the sound also comes on while you don't press it. The sound changes when pressed. If I make the code to start when it is pressed, it starts even though it is not pressed. Is it being pushed by noise? I thought it was a noise being pushed, but I made a mistake in putting the switch between Vcc (I thought it was 0 when the switch is off = open, but it's not. indefinite value), so I made a circuit for such a thing that says &quot;when the switch is pressed, it connects to GND&quot; and the code does a &lt;a href='http://www.wdic.org/w/SCI/%E3%83%97%E3%83%AB%E3%82%A2%E3%83%83%E3%83%97'> pull-up&lt;/a> in the code, apparently. You can do pull-ups in the circuit, but with Arduino, you can do it internally by just writing one line of code.

Next was the sound source IC. I was the only one who bought a sound source IC, so I am a lone soldier. I don't know how to read it. It's so complicated! It's impossible to read and understand it! But now that I think about it, all the important information is here.

f:id:nishiohirokazu:20090713141426j:image

Put the clock signal in œÜM, use 4/6 to specify whether the clock is 4 or 6 megs, and set the reset to H, assuming it is not used for now (I stumbled here! In electronic circuits, H is often false and L is true. The opposite of programmer's shipping)

&lt;img src=&quot;http://gyazo.com/6d5ff7cfa6923b8a87346d03a2d8b061.png&quot;>

In the picture, the crystal one is wired to something, but it can be open.

I thought I had done the circuit correctly, but for some reason the sound was not coming out. I was troubled for a while, but became sleepy, so I went to bed.

I wake up. They seem to have checked the circuit while I was asleep and tell me that there is nothing wrong with the circuitry. I look at the code. There are three things to do: set channel A to the tone setting, set the volume on channel A to maximum, and write 0b000100011100 (=284. 440Hz) to channel A.
I wrote 0b11111 to the $08 register at the volume setting, but the fifth bit should be 0b111111 because it is the envelope setting. I wrote 0b000001 to the $07 register when setting channel A to tone, but should have written 0b111110 because 0 is True and 1 is False. I failed to read it even though it is written correctly in the documentation. The process of &quot;writing y to address x&quot; is complicated, so I created a function to write it, but there was a bug in it. However, there was a bug in the function, and it was doing both with AD=H. Furthermore, the data to be written should be 0b000100011100, but it was 0x000100011100, which is not correct at all.

So there were tons of bugs, but the sound finally came out. Yay.

Play the tete-a-tete endlessly.

I bought another volume so I could change the tempo with it. it was very easy since all I had to do was analogRead. However, I wrote it in a non-interrupt style, so it only reads and sets at the beginning of the song, so moving it smoothly does not make it smoothly faster.

Masa-u told me, &quot;Chords, right?&quot; So I did my best. I did my best. I read the score incorrectly and played the accompaniment a semitone out of tune.

Video of the finished product: http://www.youtube.com/watch?v=x8Z8at9PRDs

Something like that. What I haven't done yet are things like interrupting with sensor input, returning sensor input to the PC side, and so on.

PS: I got the sheet music from here. http://www.nicovideo.jp/watch/sm1237915
&lt;/body>
</code></pre>
<h2 id="hatena-diary-2009-07-13"><a href="https://nishiohirokazu.hatenadiary.org/archive/2009/07/13" class="external">Hatena Diary 2009-07-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2009-07-13" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2009-07-13" class="external">/nishio/Hatena2009-07-13<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. I‚Äôm very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> ¬© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>