<!DOCTYPE html>
<html lang="en"><head><title>Hatena2010-05-17</title><meta charset="utf-8"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="og:site_name" content="ğŸª´ Quartz 4.0"/><meta property="og:title" content="Hatena2010-05-17"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Hatena2010-05-17"/><meta name="twitter:description" content="hatena &lt;body> *1274104221*[Haskell] design design design, some implementation I thought that if I suddenly started creating the entire game I was going to make, I would get ..."/><meta property="og:description" content="hatena &lt;body> *1274104221*[Haskell] design design design, some implementation I thought that if I suddenly started creating the entire game I was going to make, I would get ..."/><meta property="og:image:type" content="image/webp"/><meta property="og:image:alt" content="hatena &lt;body> *1274104221*[Haskell] design design design, some implementation I thought that if I suddenly started creating the entire game I was going to make, I would get ..."/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:width" content="1200"/><meta property="og:height" content="630"/><meta property="og:image:url" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta name="twitter:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="og:image" content="https://quartz.jzhao.xyz/static/og-image.png"/><meta property="twitter:domain" content="quartz.jzhao.xyz"/><meta property="og:url" content="https:/quartz.jzhao.xyz/Hatena2010-05-17"/><meta property="twitter:url" content="https:/quartz.jzhao.xyz/Hatena2010-05-17"/><link rel="icon" href="./static/icon.png"/><meta name="description" content="hatena &lt;body> *1274104221*[Haskell] design design design, some implementation I thought that if I suddenly started creating the entire game I was going to make, I would get ..."/><meta name="generator" content="Quartz"/><link href="./index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><script src="./prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch("./static/contentIndex.json").then(data => data.json())</script></head><body data-slug="Hatena2010-05-17"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h2 class="page-title"><a href=".">ğŸª´ Quartz 4.0</a></h2><div class="spacer mobile-only"></div><div class="search"><button class="search-button" id="search-button"><p>Search</p><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title>Search</title><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></button><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="search-layout" data-preview="true"></div></div></div></div><button class="darkmode" id="darkmode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35" xml:space="preserve" aria-label="Dark mode"><title>Dark mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background:new 0 0 100 100" xml:space="preserve" aria-label="Light mode"><title>Light mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></button></div><div class="center"><div class="page-header"><div class="popover-hint"><nav class="breadcrumb-container" aria-label="breadcrumbs"><div class="breadcrumb-element"><a href="./">Home</a><p> â¯ </p></div><div class="breadcrumb-element"><a href>Hatena2010-05-17</a></div></nav><h1 class="article-title">Hatena2010-05-17</h1><p show-comma="true" class="content-meta"><span>May 17, 2010</span><span>7 min read</span></p></div></div><article class="popover-hint"><p>hatena</p>
<pre><code>&lt;body>
*1274104221*[Haskell] design design design, some implementation
I thought that if I suddenly started creating the entire game I was going to make, I would get caught up in the details of the implementation and lose sight of the overall design. I thought that if I suddenly started creating the entire game I was going to make, I would get caught up in the &quot;how do you do that?&quot; details of the implementation and neglect the overall design. This was correct because I wanted to create a library that could be reused no matter what the game was.

I think this is more important than monads!

I think I'm about 70% right in understanding that &quot;Haskell's classes are Java's interfaces&quot;. When I used to beat around the bush in Python, objects with game data were just dictionaries, but when you want to declare their types in Haskell, you can't be so lenient. So I made a game interface (Java language) with my Java brain. I also tried to create an interface called &quot;Play&quot; (Java language), which means &quot;start&quot; in Java. I couldn't think of any particular method to put in it, so I decided to declare a method named to_str in both interfaces.

Yes, this is the incorrect point of understanding that &quot;Haskell's class is Java's interface.&quot; The scope of method names declared in Java's interface is per-instance. But Haskell's is not. It's a top-level scoped function.

In Java, when you define a method or function in a class or instance, the object is bound to the name &quot;this&quot; and then called. an_obj.a_method(an_arg) can access an_obj by accessing the variable &quot;this&quot; in a_method. In Python, calling an_obj.a_method(an_arg) would pass an_obj as the first argument to a_method. Haskell further requires that an_obj be passed as an argument since a_method is a top-level function independent of an_obj in the first place.

>|java|
// Java-like
class Foo {
  int a_method(int an_arg){
    ... (For some reason, THIS can be used.)
  }
}

Foo an_obj = new Foo();
an_obj.a_method(an_arg);
||&lt;
>|python|
# Python-like
class Foo:
  def a_method(self, an_arg):
    ... (self can be used)

an_obj = Foo()
an_obj.a_method(an_arg)
||&lt;
>|haskell|
-- Haskell style
a_method :: (Foo a) => a -> Int -> Int
a_method an_obj an_arg = ... (of course an_obj can be used)

an_obj = MakeFoo ...
result = a_method an_obj 1
||&lt;

It is strange to call a Haskell case a &quot;method&quot;. Because it doesn't belong to class Foo, it is only guaranteed to pass an argument of type Foo as its first argument.

I'm a little happy, though there is no necessity for it to be the first argument at all.
>|python|
# Python
f = an_obj.a_method
f(an_arg) # properly a_method(an_obj, an_arg)
||&lt;
>|haskell|
-- Haskell
f = a_method an_obj
f an_arg -- properly a_method an_obj an_arg
||&lt;

I've been thinking about, designing, and making containers for such things, and I'm still only working on the display of the 3-eye lineup. So, in the end, to_str is not &quot;Game's to_str&quot; or &quot;Play's to_str,&quot; but &quot;top-level to_str,&quot; so it should be a class that &quot;can be displayed,&quot; not a class called Game or Play. And that's the Show class and show.

>|haskell|
-- &quot;For each of type a such that it is an instance of class Game,
-- possible_hands has type (Play b) => a -> [b]&quot;
class Game a where
    -- takes a game phase and returns a list of possible moves to choose from
    possible_hands :: (Play b) => a -> [b]
    -- Receives games and incoming moves and returns updated new games
    step_game :: (Play b) => a -> b -> a
    -- Receive the game and return if the game is over and who won.
    check_is_finished :: a -> (Bool, Int)

-- T3 := Tic Tac Toe    
newtype T3Game = MakeT3Game {value :: [Int]}

instance Game T3Game

-- &quot;The type T3Game is an instance of class Show, where show is defined.&quot;
instance Show T3Game where 
    show xs = unlines $ map unwords $ (map (\f -> f cs) [(take 3), (take 3.drop 3), (take 3.drop 6)]) 
        where cs = map int2cell $ value xs

int2cell 0 = &quot;.&quot;
int2cell 1 = &quot;x&quot;
int2cell 2 = &quot;o&quot;           


class Play a

class Player a where
    -- Receive games and possible starting options and choose one
    think :: (Game b, Play c) => a -> b -> [c] -> c
    

main = putStr $ show $ MakeT3Game [0,0,0,0,0,1,0,0,2]
||&lt;

*1274105783*[Haskell] ... is a rigid type variable bound by ...
I don't know why this is an error, I guess that means there is still something I don't understand.
>|haskell|
class Foo a where
    foobar :: (Bar b) => a -> b

class Bar a

newtype AFoo = MakeAFoo {foo_value :: Int}
newtype ABar = MakeABar {bar_value :: Int}

instance Foo AFoo where
    foobar x = MakeABar $ foo_value x

instance Bar ABar
||&lt;

>||
    Couldn't match expected type `b' against inferred type `ABar'
      `b' is a rigid type variable bound by
          the type signature for `foobar' at tmp.hs:6:19
    In the expression: MakeABar $ foo_value x
    In the definition of `foobar': foobar x = MakeABar $ foo_value x
    In the definition for method `foobar'
||&lt;

Ah, I see. Since &quot;(Bar b) =>&quot; does not mean &quot;b is *any* instance of Bar&quot; but &quot;is *any* b that is an instance of Bar&quot;, it should not return a concrete Bar instance ABar. Because passing a foobar return value to a function that only takes another Bar instance AnotherBar is valid in terms of type inference, but the type is different at runtime and an error occurs.

>|haskell|
class Foo a where
    foobar :: (Num b) => a -> b

newtype AFoo = MakeAFoo {foo_value :: Int}

instance Foo AFoo where
    foobar x = 1
||&lt;
This is OK; why? Oh, the type of literal 1 is (Num a) => a?

>|haskell|
class Foo a where
    foobar :: (Show b) => a -> b

newtype AFoo = MakeAFoo {foo_value :: Int}

instance Foo AFoo where
    foobar x = &quot;1&quot;
||&lt;

This will result in a rigid type variable error as expected.


So how do we fix this?
&lt;/body>
&lt;comments>
&lt;comment>
&lt;username>ke&lt;/username>.
&lt;body>(Bar b) => a -> b would mean creating a function that is polymorphic with respect to the return type of the function, but is that really what you want to do? &lt;br>In Java or C++, it's like determining function overloading by the return type instead of the argument type&lt;br>There are some libraries that do that (like (=~) in Text.Regex.Posix), but usually you don't need to make the return type polymorphic. I don't think there is much need to make the return type polymorphic&lt;/body>.
&lt;timestamp>1274143885&lt;/timestamp>
&lt;/comment>
&lt;comment>
&lt;username>nishiohirokazu&lt;/username>
I think the case where the &lt;body> return type is not a specific concrete class, but one of a class that inherits from an interface (and is guaranteed to have a specific method) is common in Java, and the fact that it is not often done in Haskell suggests that the same need can be solved in a different way. I think the fact that this is not often done in Haskell means that the same need can be solved in a different way. &lt;/body>
&lt;timestamp>1274152465&lt;/timestamp>
&lt;/comment>
&lt;/comments>
</code></pre>
<h2 id="hatena-diary-2010-05-17"><a href="https://nishiohirokazu.hatenadiary.org/archive/2010/05/17" class="external">Hatena Diary 2010-05-17<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a><a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#hatena-diary-2010-05-17" class="internal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></a></h2>
<p>This page is auto-translated from <a href="https://scrapbox.io/nishio/Hatena2010-05-17" class="external">/nishio/Hatena2010-05-17<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a> using DeepL. If you looks something interesting but the auto-translated English is not good enough to understand it, feel free to let me know at <a href="https://twitter.com/nishio_en" class="external">@nishio_en<svg aria-hidden="true" class="external-icon" style="max-width:0.8em;max-height:0.8em;" viewBox="0 0 512 512"><path d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"></path></svg></a>. Iâ€™m very happy to spread my thought to non-Japanese readers.</p></article><hr/><div class="page-footer"></div></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:false}"></div><button id="global-graph-icon" aria-label="Global Graph"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></button></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div><footer class><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.4.0</a> Â© 2024</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></div></body><script type="application/javascript">function c(){let t=this.parentElement;t.classList.toggle("is-collapsed");let l=t.classList.contains("is-collapsed")?this.scrollHeight:t.scrollHeight;t.style.maxHeight=l+"px";let o=t,e=t.parentElement;for(;e;){if(!e.classList.contains("callout"))return;let n=e.classList.contains("is-collapsed")?e.scrollHeight:e.scrollHeight+o.scrollHeight;e.style.maxHeight=n+"px",o=e,e=e.parentElement}}function i(){let t=document.getElementsByClassName("callout is-collapsible");for(let s of t){let l=s.firstElementChild;if(l){l.addEventListener("click",c),window.addCleanup(()=>l.removeEventListener("click",c));let e=s.classList.contains("is-collapsed")?l.scrollHeight:s.scrollHeight;s.style.maxHeight=e+"px"}}}document.addEventListener("nav",i);window.addEventListener("resize",i);
</script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script src="./postscript.js" type="module"></script></html>